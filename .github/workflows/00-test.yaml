name: "CI - Terraform  Infrastructure"

permissions:
  pull-requests: write
  contents: read

on:
  push:
    branches:
      - "feature/**"
    inputs:
      PR:

jobs:
  ci:
    name: ci
    uses: rhoribe/test/.github/workflows/01-terraform-aws-ci.yaml@feature/test
    secrets: inherit
  
  pr: 
    name: pr
    uses: rhoribe/test/.github/workflows/00-open-pr.yaml@feature/test
    needs: ci

  costs: 
    name: costs
    uses: rhoribe/test/.github/workflows/02-terraform-aws-costs.yaml@feature/test
    with:
      PR: ${{ needs.pr.outputs.pr_number }}"
    needs: [pr,ci]
    secrets: inherit